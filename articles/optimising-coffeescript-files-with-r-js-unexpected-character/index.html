<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Optimising CoffeeScript files with r.js - "Unexpected Character" &#8211; Donald Hutchison</title>
<meta name="description" content="The Problem…

">
<meta name="keywords" content="coffee-script, development, programming">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Optimising CoffeeScript files with r.js - "Unexpected Character"">
<meta name="twitter:description" content="The Problem…

">
<meta name="twitter:site" content="@rev_kachowski">
<meta name="twitter:creator" content="@rev_kachowski">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/coffee-script.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Optimising CoffeeScript files with r.js - "Unexpected Character"">
<meta property="og:description" content="The Problem…

">
<meta property="og:url" content="/articles/optimising-coffeescript-files-with-r-js-unexpected-character/">
<meta property="og:site_name" content="Donald Hutchison">





<link rel="canonical" href="/articles/optimising-coffeescript-files-with-r-js-unexpected-character/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Donald Hutchison Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="/assets/js/vendor/html5shiv.min.js"></script>
  <script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>



<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="/" >Home</a></li>
		  
		    
		        
		    
		    <li><a href="/about/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="/articles/" >Articles</a></li>
		  
		    
		        
		    
		    <li><a href="/projects/" >Projects</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	
		<div class="wrap">
			<a href="/" class="site-logo" rel="home" title="Donald Hutchison"><img src="/images/site-logo.png" width="200" height="200" alt="Donald Hutchison logo" class="animated fadeInDown"></a>
		</div>
	
</header><!-- /.masthead -->


<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    <img src="/images/coffee-script.png" class="entry-feature-image" alt="Optimising CoffeeScript files with r.js - "Unexpected Character"" >
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#coffee-script" title="Pages tagged coffee-script">coffee-script</a></li><li><a href="/tags/#development" title="Pages tagged development">development</a></li><li><a href="/tags/#programming" title="Pages tagged programming">programming</a></li>
        </ul>
        
          <h1 class="entry-title">Optimising CoffeeScript files with r.js - "Unexpected Character"</h1>
        
      </header>
      <footer class="entry-meta">
        
        
        
          <img src="/images/portrait.jpg" class="bio-photo" alt="Donald Hutchison bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Donald Hutchison</span></span>
        <span class="entry-date date published"><time datetime="2012-06-11T00:00:00+02:00"><i class="fa fa-calendar-o"></i> June 11, 2012</time></span>
        
        
        
        
      </footer>
      <div class="entry-content">
        <h3 id="the-problem">The Problem…</h3>

<p>When trying to optimise a coffeescript project with the latest r.js optimiser from the requirejs npm module I ran into the following error:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">Cannot uglify file: /path/to/main.js. Skipping it. Error is: Unexpected character &#39;&#39; (line: 363, col: 3, pos: 15612)</code></pre></div>

<p>I downloaded the uglify-js package which r.js is using here to minify the script. Running it on the file in question in the output directory of the r.js build process gave me more information - specifically that uglify is dying on the character sequence <strong>ï»¿</strong> - a utf-8 byte order mark.</p>

<p>It turns out these marks were being input by an incorrectly configured template in visual studio. After looking into it, it appears that the BOM isn’t necessary or even recommended in UTF-8 encoded files.</p>

<h3 id="the-fix">The Fix…</h3>

<p>It follows that the quickest (and dirtiest) way is to simply strip these characters from files we wish to minify.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">grep -lZr $&#39;\357\273\277&#39; . | xargs -0 -l sed -i -e $&#39;s/\357\273\277//g&#39;</code></pre></div>

<p>This command is using the grep and sed commands (by way of xargs) to A) find all files containing the BOM and B) remove the mark from those files inplace.</p>

<p class="notice">The call to grep has the options <strong>-lZr</strong> set ( <strong>l</strong> = only display filenames in the result, <strong>Z</strong> = separate the results with \0, <strong>r</strong> = search recursively from the path provided - in this case “.” ) which we pipe to xargs and call sed once for each filename. The scary looking <strong>$’\357\273\277’</strong> is simply the <strong>ï»¿</strong> escaped. We use the <strong>$</strong> to get the shell to expand the escaped codes - otherwise grep and sed will interpret the escaped characters as a back reference to something already matched (which we don’t want).</p>

<p>Because we’re using a simple shell script to invoke the r.js command, we can throw this command in there to do some preprocessing work on our source files. Ideally, this would be in a rake/make/cakefile but this fits my needs right now.</p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/articles/coffeescript-requirejs-and-you/" class="btn" title="Coffeescript RequireJS and You!">Previous</a>
      
      
        <a href="/blog/working-title-robot-go-home-gaiden/" class="btn" title="Robot Go Home : Gaiden">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2016 Donald Hutchison. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/rev_kachowski" title="Donald Hutchison on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	
	<a href="https://linkedin.com/in/https://www.linkedin.com/pub/donald-hutchison/22/a70/16a" title="Donald Hutchison on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="https://careers.stackoverflow.com/donaldhutchison" title="Donald Hutchison on StackExchange" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
	
	
	<a href="https://github.com/rkachowski" title="Donald Hutchison on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = '';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-17488316-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script src="/assets/js/subtitle.js"></script>


</body>
</html>
